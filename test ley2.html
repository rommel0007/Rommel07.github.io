<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Test de la Tercera Ley de Newton</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .question {
            margin-bottom: 20px;
        }
        .options {
            list-style: none;
            padding: 0;
        }
        .options li {
            padding: 5px;
            border: 1px solid #ccc;
            margin-top: 5px;
            cursor: pointer;
        }
        .options li.selected {
            background-color: #cce5ff;
        }
        .button {
            display: inline-block;
            margin: 10px 5px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            cursor: pointer;
            border: none;
            font-size: 16px;
        }
        #result {
            font-weight: bold;
            margin-top: 20px;
        }
        #timer {
            font-size: 18px;
        }
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDQQLMza2AXs-ybrho_VjGWbRIB7DcjBwo",
            authDomain: "base-de-datos-usuarios-433da.firebaseapp.com",
            projectId: "base-de-datos-usuarios-433da",
            storageBucket: "base-de-datos-usuarios-433da.appspot.com",
            messagingSenderId: "563969031549",
            appId: "1:563969031549:web:66c35b0e769d73b31d2014"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.firestore = db;
        window.collection = collection;
        window.addDoc = addDoc;

    </script>
</head>
<body>
    <header>
        <h1>Test de la Tercera Ley de Newton</h1>
        <div id="timer">Tiempo restante: 2:00</div>
        <button class="button" id="startButton">¡Realiza el intento!</button>
    </header>

    <div id="quiz"></div>
    <button class="button" id="finishBtn" style="display:none;">Finalizar</button>
    <div id="result"></div>

    <script type="module">
        const questions = [
            {
                question: "¿Cuál es la fórmula de la segunda ley de Newton?",
                options: ["F = m·a", "E = m·c²", "V = I·R", "P = m·g"],
                answer: 0
            },
            {
                question: "Si duplicas la masa, ¿qué pasa con la fuerza necesaria para mantener la misma aceleración?",
                options: ["Se mantiene igual", "Se duplica", "Se reduce a la mitad", "No cambia"],
                answer: 1
            },
            {
                question: "¿Qué unidad se usa para medir la fuerza en el SI?",
                options: ["Joule", "Newton", "Pascal", "Watt"],
                answer: 1
            },
            {
                question: "Un objeto de 4 kg acelera a 3 m/s². ¿Cuál es la fuerza aplicada?",
                options: ["7 N", "1.33 N", "12 N", "0.75 N"],
                answer: 2
            },
            {
                question: "¿Qué relación existe entre fuerza neta y aceleración?",
                options: ["Son inversamente proporcionales", "No están relacionadas", "La fuerza neta causa aceleración", "La aceleración causa masa"],
                answer: 2
            },
            {
                question: "¿Cuál de estas opciones representa una fuerza de 10 N aplicada a un objeto de 2 kg?",
                options: ["10 m/s²", "5 m/s²", "20 m/s²", "2 m/s²"],
                answer: 1
            },
            {
                question: "Si un objeto no tiene fuerza neta, su aceleración es...",
                options: ["Máxima", "Mínima", "Cero", "Infinita"],
                answer: 2
            },
            {
                question: "¿Cómo afecta la fuerza neta a un objeto en reposo?",
                options: ["Lo mantiene en reposo", "Lo acelera", "Lo detiene", "Disminuye su masa"],
                answer: 1
            },
            {
                question: "¿Qué indica una aceleración negativa?",
                options: ["Aumento de velocidad", "Disminución de masa", "Disminución de velocidad", "Aceleración constante"],
                answer: 2
            },
            {
                question: "¿Qué pasa si se aplica una fuerza constante a un objeto sin fricción?",
                options: ["Acelera continuamente", "Se detiene", "Se mueve a velocidad constante", "Pierde masa"],
                answer: 0
            }
        ];

        let selectedQuestions = [];
        let userAnswers = [];
        let quizStarted = false;
        let timerInterval;
        let secondsLeft = 120;
        let startTime;
        let currentUser;

        function getUsuario() {
            currentUser = localStorage.getItem('usuario');
            if (!currentUser) {
                alert('Por favor, inicie sesión para realizar el test.');
                window.location.href = 'index.html';
            }
            return currentUser;
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(secondsLeft / 60);
            const seconds = secondsLeft % 60;
            document.getElementById('timer').textContent = `Tiempo restante: ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            secondsLeft = 120;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                secondsLeft--;
                updateTimerDisplay();
                if (secondsLeft <= 0) {
                    clearInterval(timerInterval);
                    finishQuiz(true);
                }
            }, 1000);
        }

        async function finishQuiz(timeOut = false) {
            clearInterval(timerInterval);
            document.getElementById('finishBtn').style.display = 'none';
            let score = 0;

            selectedQuestions.forEach((q, index) => {
                if (userAnswers[index] === q.answer) {
                    score += 2;
                }
            });

            const endTime = new Date();
            const elapsedTime = Math.floor((endTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            const timeSpent = `${minutes}m ${seconds}s`;

            const resultText = `Puntaje: ${score}/10<br>Tiempo usado: ${minutes}m ${seconds}s` +
                (timeOut ? "<br><span style='color:red;'>Tiempo agotado</span>" : "");

            document.getElementById('result').innerHTML = resultText;

            try {
                const usuario = getUsuario();
                await window.addDoc(window.collection(window.firestore, "test2_results"), {
                    username: usuario,
                    score: score,
                    time: timeSpent,
                    timestamp: endTime
                });
                alert('Resultados guardados correctamente. Puntaje: ' + score + ' Tiempo: ' + timeSpent);

            } catch (error) {
                console.error("Error al guardar en Firestore:", error);
                alert('Error al guardar los resultados. Por favor, inténtelo de nuevo.');
            }
        }

        function startQuiz() {
            if (quizStarted) return;
            quizStarted = true;
            userAnswers = [];
            startTime = new Date();
            secondsLeft = 120;
            document.getElementById('startButton').style.display = 'none';
            document.getElementById('finishBtn').style.display = 'inline-block';
            const quizContainer = document.getElementById('quiz');
            quizContainer.innerHTML = '';
            selectedQuestions = questions.sort(() => 0.5 - Math.random()).slice(0, 5);

            selectedQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                const questionTitle = document.createElement('h3');
                questionTitle.textContent = `Pregunta ${index + 1}: ${q.question}`;
                questionDiv.appendChild(questionTitle);

                const optionsList = document.createElement('ul');
                optionsList.className = 'options';

                q.options.forEach((option, i) => {
                    const optionItem = document.createElement('li');
                    optionItem.textContent = option;
                    optionItem.onclick = () => {
                        userAnswers[index] = i;
                        [...optionsList.children].forEach(li => li.classList.remove('selected'));
                        optionItem.classList.add('selected');
                    };
                    optionsList.appendChild(optionItem);
                });

                questionDiv.appendChild(optionsList);
                quizContainer.appendChild(questionDiv);
            });

            startTimer();
        }

        window.onload = () => {
            getUsuario();
            document.getElementById('startButton').addEventListener('click', startQuiz);
            document.getElementById('finishBtn').addEventListener('click', () => finishQuiz(false));
        }
    </script>
</body>
</html>
